@{
    ViewBag.title = "補打卡申請單";
}

@* <div class="secion mt-2">
    <div class="card">
        <form method="post" id="app">
            <div class="card-header">

                <h3 class="card-title d-flex justify-content-between">
                    <span>補打卡申請單</span>
                </h3>

            </div>
            <div class="card-body">

                <div class="row form-group basic">
                    <label class="col-form-label">申請人</label>
                    <input type="text" class="form-control" v-model="empName" readonly>

                    <i class="clear-input">
                        <ion-icon name="close-circle" role="img" class="md hydrated" aria-label="close circle"></ion-icon>
                    </i>
                </div>

                <div class="row form-group basic">
                    <label class="col-form-label">補打卡日期</label>
                    <input id="timeRange" name="dateRange" type="text" class="form-control" value="" v-model="">
                    <i class="clear-input">
                        <ion-icon name="close-circle" role="img" class="md hydrated" aria-label="close circle"></ion-icon>
                    </i>
                </div>

                <div class="row form-group basic" v-if="search.clockData && search.shiftData">
                    <div class="chip chip-media m-1">
                        <i class="chip-icon bg-warning">
                            <ion-icon name="alarm" role="img" class="md hydrated" aria-label="alarm"></ion-icon>
                        </i>
                        <span class="chip-label">當日打卡時間：{{ search.clockStart }} - {{ search.clockEnd }}</span>
                    </div>

                    <div class="chip chip-media m-1">
                        <i class="chip-icon bg-warning">
                            <ion-icon name="alarm" role="img" class="md hydrated" aria-label="alarm"></ion-icon>
                        </i>
                        <span class="chip-label">當日班表時間：{{ search.shiftStart }} - {{ search.shiftEnd }}</span>
                    </div>
                </div>

                <div class="form-group basic">
                    <div class="input-wrapper">
                        <label class="label">補卡時段</label>
                    <input type="text" class="form-control" value="" v-model="status">

                        <select class="form-control select2 select2-hidden-accessible"
                                style="width: 100%;" data-select2-id="1" tabindex="-1"
                                aria-hidden="true" v-model.number="status">
                            <option value="">---請選擇---</option>
                            <option v-for="item in clockStatusSelectItems" :value="item.value">{{item.text}}</option>
                        </select>
                        <span class="select2 select2-container select2-container--default select2-container--below select2-container--focus"
                              dir="ltr" style="width: 100%;">
                            <span class="selection"></span>
                        </span>
                        <span class="text-danger" v-if="!dataValid.status">補卡時段不得為空!</span>
                    </div>
                </div>

                <div class="row form-group basic">
                    <label class="col-form-label">補打卡原因</label>
                    <textarea class="form-control" rows="3"
                              control-id="ControlID-13" v-model="reason"></textarea>
                    <i class="clear-input">
                        <ion-icon name="close-circle" role="img" class="md hydrated" aria-label="close circle"></ion-icon>
                    </i>
                </div>

            </div>
            <div class="card-footer">

                <div class="row justify-content-around">
                    <button type="button" class="btn btn-facebook" @@click="checkCompStatus">
                        <ion-icon name="notifications-outline" role="img" class="md hydrated" aria-label="logo facebook"></ion-icon>
                        送出
                    </button>
                </div>

            </div>
        </form>
    </div>

    <div class="modal fade dialogbox" id="DialogIconedSuccess" data-backdrop="static" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-icon text-success">
                    <ion-icon name="checkmark-circle" role="img" class="md hydrated" aria-label="checkmark circle"></ion-icon>
                </div>
                <div class="modal-header">
                    <h5 class="modal-title">送出成功</h5>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <div class="btn-inline">
                        <a href="#" class="btn" data-dismiss="modal" id="successBack">返回</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade dialogbox" id="DialogIconedDanger" data-backdrop="static" tabindex="-1" role="dialog" style="display: none;" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-icon text-danger">
                    <ion-icon name="close-circle" role="img" class="md hydrated" aria-label="close circle"></ion-icon>
                </div>
                <div class="modal-header">
                    <h5 class="modal-title">送出失敗</h5>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <div class="btn-inline">
                        <a href="#" class="btn" data-dismiss="modal" id="dangerBack">返回</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div> *@


<div class="row" id="app">
    <div class="col-md">
        <form>
            <div class="card-body">
                <div class="row mb-2">
                    <label class="col-form-label">申請人：</label>
                    <input name="EmployeesId" type="text" class="col-sm-2 form-control" v-model="EmpName" readonly>
                    <div class="col-sm-auto ml-auto">
                        <label class="border rounded border-success text-green p-1 pull-right">送審中</label>
                    </div>
                </div>

                <div class="row mb-2">
                    <label class="col-form-label">補打卡日期：</label>
                    <div class="input-group date col-sm-4" id="reservationdate">
                        <div class="input-group-append">
                            <div class="input-group-text"><i class="fa fa-calendar"></i></div>
                        </div>
                        <input name="AdditionalTime" type="text" class="form-control" id="dateInput" :value="formatDate(additionalTime)" readonly>
                    </div>
                    <div class="col-sm-auto mr-auto">
                        <label class="col-form-label">顯示當日打卡狀況</label>
                    </div>
                </div>


                <div class="row mb-2">
                    <label for="Status" class="col-form-label">補卡時段：</label>

                    <select name="Status" class="form-control col-sm-3" v-model.number="status" readonly>
                        <option v-for="item in clockStatusSelectItems" :value="item.value">{{item.text}}</option>
                    </select>

                </div>

                <div class="row mb-2">
                    <label class="col-form-label">補打卡原因：</label>
                    <input name="Reason" type="text" class="col-sm-3 form-control" v-model="reason" readonly>
                </div>


                <div class="row mb-2">
                    <label class="col-form-label">審核人員：</label>
                    <input name="ApprovalEmployeeId" type="text" class="col-sm-3 form-control" v-model="approvalEmployeeId" readonly>
                </div>


            </div>
            <div class="card-footer">
                <input type="button" @@click="toList" class="btn btn-outline-dark" value="返回" />
            </div>
        </form>
    </div>
</div>

@section Scripts {

    <script>
        Vue.createApp({
            data() {
                return {
                    clockStatusSelectItems: [],
                    EmpId: 1,
                    status: '',
                    reason: '',
                    approvalEmployeeId: 2,
                    additionalTime: '',
                    shifts: [],
                    search: {
                        date: '',
                        startTime: '',
                        endTime: '',
                        clockStart: '',
                        clockEnd: ''
                    }
                }
            },
            mounted() {
                this.checkId();
                this.getCompRequestData();

                fetch("/api/AdditionalClockInApi/DropDownList").then(res => res.json())
                    .then(result => {
                        this.clockStatusSelectItems = result.clockStatusSelectItems;
                    });
            },
            methods: {
                checkId() {
                    var url = location.pathname;
                    var match = url.match(/\/(\d+)$/);

                    if (match) {
                        var lastNumber = parseInt(match[1]);
                        this.Id = lastNumber;

                    } else {
                        location.href = "/employee/query/Complement";
                    }
                },
                getCompRequestData() {
                    fetch(`/api/AdditionalClockInApi/GetCompRequestData/${this.Id}`)
                        .then(res => res.json())
                        .then(result => {
                            console.log(result);
                            // this.EmpId = result.employeesId;
                            // this.additionalTime = result.additionalTime;
                            // this.status = result.status;
                            // this.reason = result.reason;
                            // this.approvalEmployeeId = result.approvalEmployeeId;
                        });
                },
                formatDate(dateString) {
                    const options = {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit'
                    };
                    const date = new Date(dateString);
                    return date.toLocaleDateString('zh-TW', options);
                },
                formatDateTime(dateTimeString) {
                    const options = {
                        hour: '2-digit',
                        minute: '2-digit'
                    };
                    const dateTime = new Date(dateTimeString);
                    return dateTime.toLocaleTimeString('zh-TW', options);
                },
                fetchShifts() {
                    fetch(`/api/ShiftApi/GetEmpShifts/${this.EmpId}?date=${this.search.date}`)
                        .then(res => res.json())
                        .then(result => {
                            this.shifts = result;
                            this.search.date = result[0].shiftsDate;
                            this.search.startTime = result[0].shiftSchedule.startTime;
                            this.search.endTime = result[0].shiftSchedule.endTime;
                        });

                    fetch(`/api/ClockApi/GetEmpClocks/${this.EmpId}?date=${this.search.date}`)
                        .then(res => res.json())
                        .then(results => {
                            results.forEach(record => {
                                if (record.status === 0) {
                                    console.log('員工上班打卡');
                                    this.search.clockStart = record.date;
                                } else if (record.status === 1) {
                                    console.log('員工下班打卡');
                                    this.search.clockEnd = record.date;
                                } else {
                                    console.log('未知的打卡狀態');
                                }
                            });
                        });

                },
                toList() {
                    location.href = "/ApplicationForm/CompRequest";
                },
            }
        }).mount("#app");
    </script>
}
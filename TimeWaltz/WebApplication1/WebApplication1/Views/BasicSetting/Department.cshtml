@{
    Layout = "_Layout";
    ViewBag.title = "部門瀏覽";
}
<div class="row" id="app">
    <div class="col-12 mb-3">
        <div class="row">
            <label class="col-form-label col-auto">部門名稱查詢：</label>
            <form asp-action="Department" asp-controller="BasicSetting" method="post">
                <div class="row form-group">
                    <input name="QueryDepartment" class="form-control col-6" type="text" autocomplete="off" v-model="queryDepartmentName">
                    <button type="button" class="btn btn-outline-info" @@click="changeSwitch">查詢</button>
                </div>
            </form>
            <div class="col-auto ml-auto">
                <a asp-controller="BasicSetting" asp-action="DepartmentCreate" class="btn btn-outline-success pull-right">新增</a>
            </div>
        </div>
    </div>
    <div class="col-sm-8">
        <table id="example2" class="table table-bordered">
            <thead>
                <tr>
                    <th>
                        部門名稱
                    </th>
                    <th>
                        部門主管
                    </th>
                    <th scope="col">詳細資料</th>

                </tr>
            </thead>
            <tbody>
                <template v-if="isSwitch">
                    <tr class="text-center" v-for="item in filterByDepartmentName">
                        <td>{{item.departmentName}}</td>
                        <td>{{item.employeesId}}</td>
                        <td>
                            <a asp-controller="BasicSetting" asp-action="DepartmentEdit">檢視</a> |
                            <a href="#" @@click="getOut">刪除</a>
                        </td>
                    </tr>
                </template>
                <template v-else>
                    <tr class="text-center" v-for="item in departmentListData">
                        <td>{{item.departmentName}}</td>
                        <td>{{item.employeesId}}</td>
                        <td>
                            <a asp-controller="BasicSetting" asp-action="DepartmentEdit">檢視</a> |
                            <a href="#" @@click="getOut">刪除</a>
                        </td>
                    </tr>
                </template>
                
            </tbody>

        </table>
    </div>
</div>

<script>
    function confirmDelete() {
        // 使用 confirm 函數顯示確認視窗
        var result = confirm("確定要刪除嗎?");

        // 如果用戶確定，返回 true，否則返回 false
        return result;
    }
</script>

@section Scripts {

    <script>
        Vue.createApp({
            data() {
                return {
                    id: null,
                    departmentName: null,
                    employeesId: null,
                    departmentListData: [],
                    queryDepartmentName: '',
                    isSwitch: false,
                }
            },
            methods: {
                changeSwitch() {
                    this.isSwitch = !this.isSwitch;
                },
                filterByDepartmentName() {
                    if (this.queryDepartmentName != '') return this.departmentListData.filter(x => x.departmentListData.includes(this.queryDepartmentName));
                    return this.departmentListData;
                },
                getOut() {
                    let self = this;
                    axios.post(`/api/DepartmentApi/GetListData/${self.id}`)
                        .then((response) => console.log(respone))
                        .then((error) => console.log(error));
                },
                getListData() {
                    let self = this;
                    axios('/api/DepartmentApi/GetListData')
                        .then((response) => {
                            console.log(response)
                            self.departmentListData = response.data;
                        })
                        .then((error) => console.log(error));
                },
            },
            mounted() {
                this.getListData();
            },

        }).mount('#app');
    </script>
}
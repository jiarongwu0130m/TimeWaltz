@{
    Layout = "_Layout";
    ViewData["Title"] = "員工資料";
}

<div id="app">
    <form asp-action="VacationType" asp-controller="BasicSetting" method="post">
        <div class="row">
            <div class="col text-center">
                <label class="form-label">員工編號</label>
                <input type="text" class="form-control" v-model="search.empNo">
            </div>
            <div class="col text-center">
                <label class="form-label">員工姓名</label>
                <input type="text" class="form-control" v-model="search.empName">
            </div>
            <div class="col text-center">
                <label class="form-label">部門名稱</label>
                <input type="text" class="form-control" v-model="search.depName">
            </div>
            <div class="col text-center">
                <label class="form-label">班別名稱</label>
                <input type="text" class="form-control" v-model="search.shiftName">
            </div>
            <div class="col-auto m-auto">
                <a asp-controller="BasicSetting" asp-action="PersonalDataCreate" class="btn btn-outline-success pull-right">新增</a>
            </div>
        </div>
    </form>

    <hr />

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>部門</th>
                <th>員工編號</th>
                <th>員工姓名</th>
                <th>班別</th>                
                <th>詳細</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="emp in filterEmpNo">
                <td>{{emp.departmentName}}</td>
                <td>{{emp.employeesNo}}</td>
                <td>{{emp.name}}</td>
                <td>{{emp.shiftsName}}</td>
                <td>
                    <a href="#" @@click="edit(emp.id, $event)" class="btn btn-outline-primary">編輯</a>
                    <a href="#" @@click="getOut(emp.id, $event)" class="btn btn-outline-secondary">刪除</a>
                </td>
            </tr>

        </tbody>
    </table>

</div>
@section Scripts {

    <script>
        Vue.createApp({
            data() {
                return {
                    empList: [],
                    formatedHireDate: null,
                    search: {
                        shiftName: '',
                        depName: '',
                        empName: '',
                        empNo: '',

                    },
                }
            },
            computed: {
                filterShiftName() {
                    if (this.search.shiftName) return this.empList.filter(x => x.shiftsName.includes(this.search.shiftName));
                    return this.empList;
                },
                filterDepName() {
                    if (this.search.depName) return this.filterShiftName.filter(x => x.departmentName.includes(this.search.depName));
                    return this.filterShiftName;
                },
                filterEmpName() {
                    if (this.search.empName) return this.filterDepName.filter(x => x.name.includes(this.search.empName));
                    return this.filterDepName;
                },
                filterEmpNo() {
                    if (this.search.empNo) return this.filterEmpName.filter(x => x.employeesNo.includes(this.search.empNo));
                    return this.filterEmpName;
                },
            },
            methods: {
                getOut(id, event) {
                    let self = this
                    event.preventDefault();
                    fetch(`/api/PersonalDataApi/Delete/${id}`, {
                        method: "POST",

                    }).then(res => res.json()).then(result => {
                        if (result.status) {
                            alert("刪除成功")
                            this.getEmpList();
                        } else {
                            alert("刪除失敗")
                        }
                    })


                },
                edit(id, event) {
                    event.preventDefault();
                    location.href = `/BasicSetting/PersonalDataEdit/${id}`

                },
                getEmpList() {
                    let self = this;
                    fetch("/api/PersonalDataApi/GetPersonalData")
                        .then(res => res.json())
                        .then(result => {
                            //emp陣列
                            result.forEach((emp) => {
                                emp.hireDate = moment(emp.hireDate).format("YYYY-MM-DD")
                            })
                            self.empList = result;
                        });
                },
            },
            mounted() {
                this.getEmpList();
            },


        }).mount('#app');

    </script>

}

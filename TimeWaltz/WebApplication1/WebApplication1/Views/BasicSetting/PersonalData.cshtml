@model IEnumerable<WebApplication1.Models.BasicSettingViewModels.PersonalDataViewModel>

@{
    Layout = "_Layout";
    ViewData["Title"] = "";
}

<div class="row" id="app">
    <form asp-action="VacationType" asp-controller="BasicSetting" method="post">
        <div class="row">
            <div class="col">
                <div>
                    <label class="form-label">班別名稱</label>
                    <div class="row gx-0">
                        <div class="col-6">
                            <input type="text" class="form-control" v-model="search.shiftName">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div>
                    <label class="form-label">部門名稱</label>
                    <div class="row gx-0">
                        <div class="col-6">
                            <input type="text" class="form-control" v-model="search.depName">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div>
                    <label class="form-label">員工名稱</label>
                    <div class="row gx-0">
                        <div class="col-6">
                            <input type="text" class="form-control" v-model="search.empName">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div>
                    <label class="form-label">員工編號</label>
                    <div class="row gx-0">
                        <div class="col-6">
                            <input type="text" class="form-control" v-model="search.empNo">
                        </div>
                    </div>
                </div>
            </div>
            <div class="col">
                <div>
                    <label class="form-label"></label>
                    <div class="row gx-0">
                        <div class="col-6">
                            <a asp-controller="BasicSetting" asp-action="PersonalDataCreate" class="btn btn-outline-success">新增</a>
                        </div>
                    </div>
                </div>
                <div class="form-group col-12">
                </div>
            </div>
        </div>
        <hr />

    </form>


    <table class="table table-bordered">
        <thead>
        <thead>
            <tr>
                <th>
                    班別名稱
                </th>
                <th>
                    部門
                </th>
                <th>
                    員工名稱
                </th>
                <th>
                    雇傭日期
                </th>
                <th>
                    員工信箱
                </th>
                <th>
                    性別
                </th>
                <th>
                    員工編號
                </th>
                <th></th>
            </tr>
        </thead>
        </thead>
        <tbody>
            <tr v-for="emp in filterEmpNo">
                <td>
                    {{emp.shiftsName}}
                </td>

                <td>
                    {{emp.departmentName}}
                </td>

                <td>
                    {{emp.name}}
                </td>

                <td>
                    {{emp.hireDate}}
                </td>
                <td>
                    {{emp.email}}
                </td>
                <td>
                    {{emp.gender}}
                </td>
                <td>
                    {{emp.employeesNo}}
                </td>
                <td>
                    <a href="#" @@click="edit(emp.id, $event)">編輯</a> |
                    <a href="#" @@click="getOut(emp.id, $event)">刪除</a> 

                </td>
            </tr>

        </tbody>
    </table>

</div>
@section Scripts {

    <script>
        Vue.createApp({
            data() {
                return {
                    empList: [],
                    formatedHireDate: null,
                    search: {
                        shiftName: '',
                        depName: '',
                        empName: '',
                        empNo: '',

                    },
                }
            },
            computed: {
                filterShiftName() {
                    if (this.search.shiftName) return this.empList.filter(x => x.shiftsName.includes(this.search.shiftName));
                    return this.empList;
                },
                filterDepName() {
                    if (this.search.depName) return this.filterShiftName.filter(x => x.departmentName.includes(this.search.depName));
                    return this.filterShiftName;
                },
                filterEmpName() {
                    if (this.search.empName) return this.filterDepName.filter(x => x.name.includes(this.search.empName));
                    return this.filterDepName;
                },
                filterEmpNo() {
                    if (this.search.empNo) return this.filterEmpName.filter(x => x.employeesNo.includes(this.search.empNo));
                    return this.filterEmpName;
                },
            },
            methods: {
                getOut(id, event) {
                    let self = this
                    const fd = new FormData();
                    fd.append("Id", id);
                    console.debug('delete:', id);
                    event.preventDefault();
                    fetch(`/api/PersonalDataApi/Delete`, {
                        body: fd,
                        method: "POST",

                    }).then(res => res.json()).then(result => {
                        if (result.status) {
                            alert("刪除成功")
                        } else {
                            alert("刪除失敗")
                        }
                    })


                },
                edit(id, event) {
                    event.preventDefault();
                    location.href = `/BasicSetting/PersonalDataEdit/${id}`

                },
                getEmpList() {
                    let self = this;
                    fetch("/api/PersonalDataApi/GetPersonalData")
                        .then(res => res.json())
                        .then(result => {
                            //emp陣列
                            result.forEach((emp) => {
                                emp.hireDate = moment(emp.hireDate).format("YYYY-MM-DD")
                            })
                            self.empList = result;
                        });
                },
            },
            mounted() {
                this.getEmpList();
            },


        }).mount('#app');

    </script>

}
